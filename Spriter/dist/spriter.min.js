!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Spriter",[],e):"object"==typeof exports?exports.Spriter=e():t.Spriter=e()}(self,(()=>(()=>{"use strict";var t,e,i,s,r={d:(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};r.r(a),r.d(a,{Loader:()=>b,Spriter:()=>h,SpriterFile:()=>T,SpriterGroup:()=>I,SpriterJSON:()=>Y,SpriterXml:()=>R,eFileType:()=>i,eImageNameType:()=>s});class n{constructor(){this._items=[],this._itemNames=[]}add(t,e,i){void 0===e&&(e=this._items.length),null==i&&(i="item_"+e),this._items[e]=t,this._itemNames[i]=e}getById(t){return this._items[t]}getByName(t){var e=this._itemNames[t];return"number"==typeof e?this._items[e]:null}get length(){return this._items.length}}class h{constructor(){this._folders=new n,this._tags=new n,this._entities=new n}addFolder(t){this._folders.add(t,t.id,t.name)}getFolderById(t){return this._folders.getById(t)}getFolderByName(t){return this._folders.getByName(t)}addEntity(t){this._entities.add(t,t.id,t.name)}getEntityById(t){return this._entities.getById(t)}getEntityByName(t){return this._entities.getByName(t)}addTag(t){this._tags.add(t,t.id,t.name)}getTagById(t){return this._tags.getById(t)}getTagByName(t){return this._tags.getByName(t)}get tagsLength(){return this._tags.length}}class l{constructor(){this.reset()}get current(){return this._line.at(this._currentIndex)}get currentIndex(){return this._currentIndex}get next(){return this._line.at(this._nextIndex)}get nextIndex(){return this._nextIndex}set lastTime(t){this._lastTime=t}set line(t){this._line=t}get line(){return this._line}reset(){this._lastTime=-1,this._currentIndex=-1,this._nextIndex=0}step(t){var e=this._nextIndex,i=this._line.keys[e],s=i.time,r=t<this._lastTime;return!r&&s>this._lastTime&&s<=t||r&&(s>this._lastTime||s<=t)?(this._lastTime=s,this._currentIndex=e,++e>=this._line.keys.length&&(e=0),this._nextIndex=e,i):(r&&(this._lastTime=-1),null)}}function o(t,e,i){return(e-t)*i+t}function d(t,e,i,s){return o(o(t,e,s),o(e,i,s),s)}function p(t,e,i,s,r){return o(d(t,e,i,r),d(e,i,s,r),r)}function g(t,e,i,s,r,a){return o(p(t,e,i,s,a),p(e,i,s,r,a),a)}function _(t,e,i){var s=1-i,r=i*i,a=s*s;return 0+3*a*i*t+3*s*r*e+1*(r*i)}class m{constructor(t,e){this._id=t,this._name=e}get id(){return this._id}get name(){return this._name}}!function(t){t[t.NO_LOOPING=0]="NO_LOOPING",t[t.LOOPING=1]="LOOPING"}(t||(t={}));class u extends m{constructor(t,e,i,s){super(t,e),this._length=i,this._loopType=s,this._timelines=new n,this._lines=new n}get mainline(){return this._mainline}set mainline(t){this._mainline=t}addTimeline(t){this._timelines.add(t,t.id,t.name)}getTimelineById(t){return this._timelines.getById(t)}getTimelineByName(t){return this._timelines.getByName(t)}addLine(t){this._lines.add(t,this._lines.length,t.name)}getLineById(t){return this._lines.getById(t)}getLineByName(t){return this._lines.getByName(t)}get linesLength(){return this._lines.length}get length(){return this._length}get loopType(){return this._loopType}}class c{constructor(){this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.pivotX=0,this.pivotY=0,this.alpha=1,this.angle=0}}class f{constructor(){this.timeline=-1,this.timelineKey=-1,this.transformed=new c}setOn(t){this._on=t}get on(){return this._on}setKey(e,i,s,r){this.timeline=s,this.timelineKey=r;var a=i.getTimelineById(s);this.name=a.name,this.objectInfo=-1===a.objectRef?null:e.getObjectInfoById(a.objectRef);var n=a.at(r),h=a.at(r+1,i.loopType!==t.NO_LOOPING);this.key=n,this.timeFrom=n.time,this.timeTo=h.time,this.timeTo<this.timeFrom&&(this.timeTo=i.length),this.from=n.info,this.to=h.info,this.updateMask=0,Math.abs(this.from.x-this.to.x)>.001&&(this.updateMask+=f.UPDATE_X),Math.abs(this.from.y-this.to.y)>.001&&(this.updateMask+=f.UPDATE_Y),Math.abs(this.from.scaleX-this.to.scaleX)>.001&&(this.updateMask+=f.UPDATE_SCALE_X),Math.abs(this.from.scaleY-this.to.scaleY)>.001&&(this.updateMask+=f.UPDATE_SCALE_Y),Math.abs(this.from.pivotX-this.to.pivotX)>.001&&(this.updateMask+=f.UPDATE_PIVOT_X),Math.abs(this.from.pivotY-this.to.pivotY)>.001&&(this.updateMask+=f.UPDATE_PIVOT_Y),Math.abs(this.from.alpha-this.to.alpha)>.001&&(this.updateMask+=f.UPDATE_ALPHA),Math.abs(this.from.angle-this.to.angle)>.001&&(this.updateMask+=f.UPDATE_ANGLE),this.transformed.x=this.from.x,this.transformed.y=this.from.y,this.transformed.scaleX=this.from.scaleX,this.transformed.scaleY=this.from.scaleY,this.transformed.pivotX=this.from.pivotX,this.transformed.pivotY=this.from.pivotY,this.transformed.angle=this.from.angle,this.transformed.alpha=this.from.alpha}tween(t){var e=this.updateMask>0?this.getTweenTime(t):0;this.transformed.x=(this.updateMask&f.UPDATE_X)>0?o(this.from.x,this.to.x,e):this.from.x,this.transformed.y=(this.updateMask&f.UPDATE_Y)>0?o(this.from.y,this.to.y,e):this.from.y,this.transformed.scaleX=(this.updateMask&f.UPDATE_SCALE_X)>0?o(this.from.scaleX,this.to.scaleX,e):this.from.scaleX,this.transformed.scaleY=(this.updateMask&f.UPDATE_SCALE_Y)>0?o(this.from.scaleY,this.to.scaleY,e):this.from.scaleY,this.transformed.pivotX=(this.updateMask&f.UPDATE_PIVOT_X)>0?o(this.from.pivotX,this.to.pivotX,e):this.from.pivotX,this.transformed.pivotY=(this.updateMask&f.UPDATE_PIVOT_Y)>0?o(this.from.pivotY,this.to.pivotY,e):this.from.pivotY,this.transformed.alpha=(this.updateMask&f.UPDATE_ALPHA)>0?o(this.from.alpha,this.to.alpha,e):this.from.alpha,this.transformed.angle=(this.updateMask&f.UPDATE_ANGLE)>0?function(t,e,i,s){return 0===i?t:(i>0?e>t&&(e-=360):e<t&&(e+=360),o(t,e,s))}(this.from.angle,this.to.angle,this.key.spin,e):this.from.angle}update(t){this.transformed.angle*=Phaser.Math.sign(t.scaleX)*Phaser.Math.sign(t.scaleY),this.transformed.angle+=t.angle,this.transformed.scaleX*=t.scaleX,this.transformed.scaleY*=t.scaleY,this.scalePosition(t.scaleX,t.scaleY),this.rotatePosition(t.angle),this.translatePosition(t.x,t.y),this.transformed.alpha*=t.alpha}scalePosition(t,e){this.transformed.x*=t,this.transformed.y*=e}rotatePosition(t){var e=this.transformed.x,i=this.transformed.y;if(0!==e||0!==i){var s=t*(Math.PI/180),r=Math.cos(s),a=Math.sin(s);this.transformed.x=e*r-i*a,this.transformed.y=e*a+i*r}}translatePosition(t,e){this.transformed.x+=t,this.transformed.y+=e}getTweenTime(t){if(1===this.key.curveType)return 0;var e=Phaser.Math.clamp((t-this.timeFrom)/(this.timeTo-this.timeFrom),0,1);switch(this.key.curveType){case 0:return e;case 2:return d(0,this.key.c1,1,e);case 3:return p(0,this.key.c1,this.key.c2,1,e);case 4:return g(0,this.key.c1,this.key.c2,this.key.c3,1,e);case 5:return function(t,e,i,s,r,a,n){return o(g(t,e,i,s,r,n),g(e,i,s,r,a,n),n)}(0,this.key.c1,this.key.c2,this.key.c3,this.key.c4,1,e);case 6:return function(t,e,i,s,r){for(var a=0,n=1,h=(n+a)/2,l=_(t,i,h),o=0;Math.abs(r-l)>.001&&o<10;)r>l?a=h:n=h,l=_(t,i,h=(n+a)/2),++o;return _(e,s,h)}(this.key.c1,this.key.c2,this.key.c3,this.key.c4,e)}return 0}}f.UPDATE_X=1,f.UPDATE_Y=2,f.UPDATE_SCALE_X=4,f.UPDATE_SCALE_Y=8,f.UPDATE_PIVOT_X=16,f.UPDATE_PIVOT_Y=32,f.UPDATE_ANGLE=64,f.UPDATE_ALPHA=128;class y extends f{constructor(t,e){super(),this._spriter=t.spriter,this._charMapStack=t.charMapStack,this._sprite=e}get sprite(){return this._sprite}setOn(t,e=!1){super.setOn(t),this._sprite.exists=t&&!e,this._sprite.visible=t&&!this._hide&&!e}setKey(t,e,i,s){if(super.setKey(t,e,i,s),0===this.type){var r=this.key,a=this._spriter.getFolderById(r.folder).getFileById(r.file);this._file=a,this.setFile(a)}else this._file=null}resetFile(){0===this.type&&this.setFile(this._file)}setFile(t){null!==(t=this._charMapStack.getFile(t))?(this._hide=!1,this._sprite.frameName=t.name):(this._hide=!0,this._sprite.visible=!1)}updateSprite(){var t=this.transformed,e=this.sprite;e.position.set(t.x,t.y),e.scale.set(t.scaleX,t.scaleY),e.anchor.set(t.pivotX,t.pivotY),e.alpha=t.alpha,e.angle=t.angle}}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.MAIN_LINE=1]="MAIN_LINE",t[t.TIME_LINE=2]="TIME_LINE",t[t.SOUND_LINE=3]="SOUND_LINE",t[t.EVENT_LINE=4]="EVENT_LINE",t[t.TAG_LINE=5]="TAG_LINE",t[t.VAR_LINE=6]="VAR_LINE"}(e||(e={}));class v extends m{constructor(t,i=null){super(t,i),this._type=e.UNKNOWN}get type(){return this._type}set type(t){this._type=t}get keys(){return this._keys}add(t){null!==this._keys&&void 0!==this._keys||(this._keys=[]),this._keys.push(t)}at(t,e=!0){if(t<0)return null;var i=this._keys.length;return t>=i&&(e?t%=i:t=i-1),this._keys[t]}}class N{constructor(t){this._stack=[],this._length=0,this._entity=t}reset(){this._length=0}push(t){var e=this.getCharMap(t);this._stack[this._length++]=e}remove(t){var e=this.getCharMap(t),i=this.findCharMap(e);if(-1!==i){for(var s=i;s<this._length-2;s++)this._stack[s]=this._stack[s+1];this._stack[--this._length]=null}}getFile(t){for(var e=this._length-1;e>=0;e--){var i=this._stack[e].value(t.name);if(void 0!==i)return i}return t}getCharMap(t){return this._entity.getCharMapByName(t)}findCharMap(t){for(var e=0;e<this._length;e++)if(this._stack[e]===t)return e;return-1}}class I extends Phaser.Group{constructor(t,e,i,s,r,a){super(t,null),this.onLoop=new Phaser.Signal,this.onFinish=new Phaser.Signal,this.onSound=new Phaser.Signal,this.onEvent=new Phaser.Signal,this.onTagChange=new Phaser.Signal,this.onVariableSet=new Phaser.Signal,this.onBoxUpdated=new Phaser.Signal,this.onPointUpdated=new Phaser.Signal,this._mainlineStepper=new l,this._lineSteppers=[],this._lineSteppersCount=0,this._bones=[],this._objects=[],this._tags=0,this._vars=[],this._paused=!1,this._spriter=e,this._entityName=s,this._entity=e.getEntityByName(s),this._textureKey=i,this._root=new c;for(var n=0;n<this._entity.variablesLength;n++)this._vars[n]=this._entity.getVariableById(n).clone();this._charMapStack=new N(this._entity),void 0===a&&(a=100),this.setAnimationSpeedPercent(a),null==r?this.playAnimationById(0):"number"==typeof r?this.playAnimationById(r):this.playAnimationByName(r)}get spriter(){return this._spriter}get entity(){return this._entity}get charMapStack(){return this._charMapStack}get paused(){return this._paused}set paused(t){this._paused=t}get animationsCount(){return this._entity.animationsLength}get currentAnimationName(){return this._animationName}pushCharMap(t){this._charMapStack.push(t),this.resetSprites()}removeCharMap(t){this._charMapStack.remove(t),this.resetSprites()}clearCharMaps(){this._charMapStack.reset(),this.resetSprites()}resetSprites(){for(var t=0;t<this._objects.length;t++)this._objects[t].resetFile()}isTagOn(t){return this.isTagOnById(this._spriter.getTagByName(t).id)}isTagOnById(t){return(this._tags&1<<t)>0}getVariable(t){return this.getVariableById(this._entity.getVariableByName(t).id)}getVariableById(t){return this._vars[t]}getObject(t){for(var e=0;e<this._objects.length;e++){var i=this._objects[e];if(i.name===t)return i}return null}setAnimationSpeedPercent(t=100){this._animationSpeed=t/100}playAnimationById(t){var e=this._entity.getAnimationById(t);null!=e&&this.playAnimation(e)}playAnimationByName(t){var e=this._entity.getAnimationByName(t);null!=e&&this.playAnimation(e)}playAnimation(t){this._animationName=t.name,this._animation=t,this._finished=!1,this._mainlineStepper.reset(),this._mainlineStepper.line=this._animation.mainline,this._time=0,this.resetLines(),this._tags=0;for(var e=0;e<this._vars.length;e++)this._vars[e].reset();this.loadKeys(this._animation.mainline.at(0),!0),this.updateCharacter()}resetLines(){this._lineSteppersCount=0;for(var t=0;t<this._animation.linesLength;t++){var e=this._animation.getLineById(t);this._lineSteppersCount>=this._lineSteppers.length&&(this._lineSteppers[this._lineSteppersCount]=new l);var i=this._lineSteppers[this._lineSteppersCount++];i.reset(),i.line=e}}setBones(t,e=!1){for(var i=0;i<this._bones.length;i++)void 0!==this._bones[i]&&this._bones[i].setOn(!1);for(i=0;i<t.length;i++){var s=t[i];if(void 0===this._bones[s.id]){var r=new f;r.type=1,this._bones[s.id]=r}var a=this._bones[s.id];a.setOn(!0),a.parent=s.parent,(a.timelineKey!==s.key||a.timeline!==s.timeline||e)&&a.setKey(this._entity,this._animation,s.timeline,s.key)}}setObjects(t,e=!1){for(var i=0;i<this._objects.length;i++)void 0!==this._objects[i]&&this._objects[i].setOn(!1);var s=!1;for(i=0;i<t.length;i++){var r=t[i],a=null,n=null;void 0===this._objects[r.id]?(n=new Phaser.Sprite(this.game,0,0,this._textureKey),a=new y(this,n),this._objects[r.id]=a,this.add(n)):n=(a=this._objects[r.id]).sprite,a.parent=r.parent,a.type=this._animation.getTimelineById(r.timeline).objectType,0===a.type?(a.setOn(!0),a.sprite.z!==r.z&&(a.sprite.z=r.z,s=!0)):a.setOn(!0,!0),(a.timelineKey!==r.key||a.timeline!==r.timeline||e)&&a.setKey(this._entity,this._animation,r.timeline,r.key)}s&&this.sort()}loadKeys(t,e=!1){this.setBones(t.boneRefs,e),this.setObjects(t.objectRefs,e)}updateAnimation(){if(!this._paused&&!this._finished){var e,i=this._mainlineStepper;for(this._time>this._animation.length&&(this._animation.loopType===t.NO_LOOPING?(this._time=this._animation.length,this._finished=!0):(this._time-=this._animation.length,this.onLoop.dispatch(this)));null!==(e=i.step(this._time));)this.loadKeys(e),i.lastTime=e.time;this.updateCharacter(),this.updateLines(),this._finished&&this.onFinish.dispatch(this),this._time+=this.game.time.delta*this._animationSpeed}}updateCharacter(){for(var t=0;t<this._bones.length;t++){var e=this._bones[t];if(e.on){var i=-1===e.parent?this._root:this._bones[e.parent].transformed;e.tween(this._time),e.update(i)}}for(t=0;t<this._objects.length;t++){var s=this._objects[t];if(s.on){i=-1===s.parent?this._root:this._bones[s.parent].transformed;s.tween(this._time),s.update(i),0===s.type?s.updateSprite():2===s.type?this.onBoxUpdated.dispatch(this,s):3===s.type&&this.onPointUpdated.dispatch(this,s)}}}updateLines(){for(var t=this._lineSteppersCount-1;t>=0;t--)for(var i,s=this._lineSteppers[t],r=s.line;null!==(i=s.step(this._time));){switch(r.type){case e.SOUND_LINE:this.onSound.dispatch(this,r.name);break;case e.EVENT_LINE:this.onEvent.dispatch(this,r.name);break;case e.TAG_LINE:var a=i.tagsOn,n=this._tags^a;this._tags=a;for(var h=0;h<this._spriter.tagsLength;h++){var l=1<<h;n&l&&this.onTagChange.dispatch(this,this._spriter.getTagById(h).name,(a&l)>0)}break;case e.VAR_LINE:var o=i.value,d=this._vars[r.varDefId];d.value=o,this.onVariableSet.dispatch(this,d)}s.lastTime=i.time}}}!function(t){t[t.XML=0]="XML",t[t.JSON=1]="JSON",t[t.BIN=2]="BIN"}(i||(i={})),function(t){t[t.ORIGINAL=0]="ORIGINAL",t[t.NAME_ONLY=1]="NAME_ONLY",t[t.NAME_AND_EXTENSION=2]="NAME_AND_EXTENSION",t[t.FULL_PATH_NO_EXTENSION=3]="FULL_PATH_NO_EXTENSION"}(s||(s={}));class T{constructor(t){let e=null!=t;this._imageNameType=e&&void 0!==t.imageNameType?t.imageNameType:s.NAME_ONLY,this._minDefs=e&&void 0!==t.minDefs?t.minDefs:null}processed(){this.popMinDefsStack()}setMinimized(t){this._minimized=t,!t||(this._minDefsStack=[],this._minDefs)}getFileName(t){let e;switch(this._imageNameType){case s.NAME_ONLY:e=t.split("\\").pop().split("/").pop().split(".")[0];break;case s.NAME_AND_EXTENSION:e=t.split("\\").pop().split("/").pop();break;case s.FULL_PATH_NO_EXTENSION:e=t.split(".")[0];break;case s.ORIGINAL:e=t}return e}translateElementName(t){if(this._minimized){if(this._minDefs.name!==t)return t;null!==this._minDefs.minName&&(t=this._minDefs.minName)}return t}translateChildElementName(t){if(this._minimized&&null!==this._minDefs){var e=this._minDefs.childElements;null!==e&&(t=null===e[t]?t:e[t].minName)}return t}translateAttributeName(t){if(this._minimized&&null!==this._minDefs){var e=this._minDefs.attributes;null!==e&&(t=null===e[t]?t:e[t])}return t}setMinDefsToElementName(t){if(this._minimized){this._minDefsStack.push(this._minDefs);var e=this._minDefs.childElements[t];this._minDefs=e}}popMinDefsStack(){this._minimized&&(this._minDefs=this._minDefsStack.pop())}}class b{load(t){this._spriter=new h,this._fileType=t.getType();var e=t.getNodes("folder");this.loadFolders(this._spriter,e),e.processed();var i=t.getNodes("tag_list");this.loadTags(this._spriter,i),i.processed();var s=t.getNodes("entity");return this.loadEntities(this._spriter,s),s.processed(),this._spriter}loadFolders(t,e){for(var i=0;i<e.length();i++){var s=e.getFolder(i),r=e.getChildNodes(i,"file");this.loadFiles(s,r),r.processed(),t.addFolder(s)}}loadFiles(t,e){for(var i=0;i<e.length();i++){var s=e.getFile(i);null!==s&&t.addFile(s)}}loadTags(t,e){if(0!==e.length()){var s;s=this._fileType!==i.JSON?e.getChildNodes(0,"i"):e;for(var r=0;r<s.length();r++){var a=s.getTag(r);t.addTag(a)}this._fileType!==i.JSON&&s.processed()}}loadEntities(t,e){for(var i=0;i<e.length();i++){var s=e.getEntity(i),r=e.getChildNodes(i,"obj_info");this.loadObjInfo(s,r),r.processed();var a=e.getChildNodes(i,"character_map");this.loadCharMaps(s,a),a.processed();var n=e.getChildNodes(i,"var_defs");this.loadVariables(s,n),n.processed();var h=e.getChildNodes(i,"animation");this.loadAnimations(s,h),h.processed(),t.addEntity(s)}}loadObjInfo(t,e){for(var i=0;i<e.length();i++){var s=e.getObjectInfo(i);t.addObjectInfo(s)}}loadCharMaps(t,e){for(var i=0;i<e.length();i++){var s=e.getCharMap(i),r=e.getChildNodes(i,"map");this.loadCharMapEntries(s,r),r.processed(),t.addCharMap(s)}}loadCharMapEntries(t,e){for(var i=0;i<e.length();i++)e.getCharMapEntry(i,t,this._spriter)}loadVariables(t,e){if(0!==e.length()){var s;s=this._fileType!==i.JSON?e.getChildNodes(0,"i"):e;for(var r=0;r<s.length();r++){var a=s.getVariable(r);t.addVariable(a)}this._fileType!==i.JSON&&s.processed()}}loadAnimations(t,e){for(var s=0;s<e.length();s++){var r=e.getAnimation(s),a=e.getChildNodes(s,"mainline");this.loadMainline(r,a),a.processed();var n=e.getChildNodes(s,"timeline");this.loadTimelines(r,n),n.processed();var h=e.getChildNodes(s,"soundline");this.loadSoundlines(r,h),h.processed();var l=e.getChildNodes(s,"eventline");this.loadEventlines(r,l),l.processed();var o=e.getChildNodes(s,"meta");if(o.length()>0){var d=o.getChildNodes(0,this._fileType!==i.JSON?"varline":"valline");this.loadVarlines(t,r,d),d.processed();var p=o.getChildNodes(0,"tagline");this.loadTaglines(r,p),p.processed()}o.processed(),t.addAnimation(r)}}loadMainline(t,i){var s=i.getMainline(0);s.type=e.MAIN_LINE;var r=i.getChildNodes(0,"key");this.loadMainlineKeys(s,r),r.processed(),t.mainline=s}loadMainlineKeys(t,e){for(var i=0;i<e.length();i++){for(var s=e.getMainlineKey(i),r=e.getChildNodes(i,"bone_ref"),a=0;a<r.length();a++)s.addBoneRef(r.getRef(a));r.processed();for(var n=e.getChildNodes(i,"object_ref"),h=0;h<n.length();h++)s.addObjectRef(n.getRef(h));n.processed(),t.add(s)}}loadTimelines(t,e){for(var i=0;i<e.length();i++){var s=e.getTimeline(i),r=e.getChildNodes(i,"key");this.loadTimelineKeys(s,r),r.processed(),t.addTimeline(s)}}loadTimelineKeys(t,e){for(var i=0;i<e.length();i++){var s=e.getTimelineKey(i,this._spriter);t.add(s)}}loadSoundlines(t,i){for(var s=0;s<i.length();s++){var r=i.getSoundline(s);r.type=e.SOUND_LINE;var a=i.getChildNodes(s,"key");this.loadKeys(r,a),a.processed(),t.addLine(r)}}loadKeys(t,e){for(var i=0;i<e.length();i++){var s=e.getKey(i);t.add(s)}}loadEventlines(t,i){for(var s=0;s<i.length();s++){var r=i.getEventline(s);r.type=e.EVENT_LINE;var a=i.getChildNodes(s,"key");this.loadKeys(r,a),a.processed(),t.addLine(r)}}loadTaglines(t,i){for(var s=0;s<i.length();s++){var r=i.getTagline(s);r.type=e.TAG_LINE;var a=i.getChildNodes(s,"key");this.loadTagKeys(r,a),a.processed(),t.addLine(r)}}loadTagKeys(t,e){for(var i=0;i<e.length();i++){var s=e.getTagKey(i),r=e.getChildNodes(i,"tag"),a=r.getTagChanges(this._spriter);r.processed(),s.tagsOn=a,t.add(s)}}loadVarlines(t,e,i){for(var s=0;s<i.length();s++){var r=i.getVarline(s),a=t.getVariableById(r.varDefId).type,n=i.getChildNodes(s,"key");this.loadVariableKeys(r,n,a),n.processed(),e.addLine(r)}}loadVariableKeys(t,e,i){for(var s=0;s<e.length();s++){var r=e.getVariableKey(s,i);t.add(r)}}}class E extends m{put(t,e){void 0===this._map&&(this._map={}),this._map[t],this._map[t]=e}value(t){return this._map[t]}}class S extends m{constructor(t,e){super(t,e),this._objectInfos=new n,this._charMaps=new n,this._variables=new n,this._animations=new n}addObjectInfo(t){this._objectInfos.add(t,t.id,t.name)}getObjectInfoById(t){return this._objectInfos.getById(t)}getObjectInfoByName(t){return this._objectInfos.getByName(t)}addCharMap(t){this._charMaps.add(t,t.id,t.name)}getCharMapById(t){return this._charMaps.getById(t)}getCharMapByName(t){return this._charMaps.getByName(t)}get charMapsLength(){return this._charMaps.length}addVariable(t){this._variables.add(t,t.id,t.name)}getVariableById(t){return this._variables.getById(t)}getVariableByName(t){return this._variables.getByName(t)}get variablesLength(){return this._variables.length}addAnimation(t){this._animations.add(t,t.id,t.name)}getAnimationById(t){return this._animations.getById(t)}getAnimationByName(t){return this._animations.getByName(t)}get animationsLength(){return this._animations.length}}class F extends m{constructor(t,e,i,s){super(t,e),this._pivotX=i,this._pivotY=s}get pivotX(){return this._pivotX}get pivotY(){return this._pivotY}}class M extends m{constructor(t,e){super(t,e),this._files=new n}addFile(t){this._files.add(t,t.id,t.name)}getFileById(t){return this._files.getById(t)}getFileByName(t){return this._files.getByName(t)}}class A{constructor(t,e){this._id=t,this._time=e}get id(){return this._id}get time(){return this._time}}class L extends A{constructor(t,e,i){super(t,e),this._info=new c,this._spin=i,this.setCurve(0)}setCurve(t,e=0,i=0,s=0,r=0){this._curveType=t,this._c1=e,this._c2=i,this._c3=s,this._c4=r}get spin(){return this._spin}get curveType(){return this._curveType}get c1(){return this._c1}get c2(){return this._c2}get c3(){return this._c3}get c4(){return this._c4}get info(){return this._info}}class O extends L{}class B extends A{constructor(){super(...arguments),this._boneRefs=[],this._objectRefs=[]}get boneRefs(){return this._boneRefs}addBoneRef(t){this._boneRefs.push(t)}get objectRefs(){return this._objectRefs}addObjectRef(t){this._objectRefs.push(t)}}class C extends L{setFolderAndFile(t,e){this._folder=t,this._file=e}get folder(){return this._folder}get file(){return this._file}}class k extends A{get tagsOn(){return this._tagsOn}set tagsOn(t){this._tagsOn=t}}class w extends A{constructor(t,e,i){super(t,e),this._value=i}get value(){return this._value}}class x extends m{constructor(t,e,i,s,r,a,n){super(t,e),this._type=i,this._width=s,this._height=r,this._pivotX=a,this._pivotY=n}get type(){return this._type}get width(){return this._width}get height(){return this._height}get pivotX(){return this._pivotX}get pivotY(){return this._pivotY}}class j{constructor(t,e,i,s,r=0){this.id=t,this.parent=e,this.timeline=i,this.key=s,this.z=r}}class P extends v{constructor(t,i,s=0,r=-1){super(t,i),this.type=e.TIME_LINE,this._objectType=s,this._objectRef=r}get objectType(){return this._objectType}get objectRef(){return this._objectRef}}class D{static getObjectTypeForName(t){var e=D.nameToObjectType[t];return e}static getCurveTypeForName(t){var e=D.nameToCurveType[t];return e}static getVariableTypeForName(t){var e=D.nameToVariableType[t];return e}}D.nameToObjectType={sprite:0,bone:1,box:2,point:3,sound:4},D.nameToCurveType={instant:1,linear:0,quadratic:2,cubic:3,quartic:4,quintic:5,bezier:6},D.nameToVariableType={int:0,float:1,string:2};class K extends m{constructor(t,e,i,s){super(t,e),this._type=i,this._default=s,this.reset()}clone(){return new K(this.id,this.name,this.type,this._default)}reset(){this.value=this._default}get type(){return this._type}get value(){return this._value}set value(t){0===this._type?this._value=Math.floor(t):this._value=t}get int(){return this._value}get float(){return this._value}get string(){return this._value}}class V extends v{constructor(t,i){super(t,null),this._varDefId=i,this.type=e.VAR_LINE}get varDefId(){return this._varDefId}}class X{constructor(t,e){this._file=t,this._nodeList=e,Array.isArray(e)||(e.length=1)}length(){return this._nodeList.length}processed(){this._file.processed()}getNode(t){return Array.isArray(this._nodeList)?this._nodeList[t]:this._nodeList}getChildNodes(t,e){return this._file.getNodesForElement(this.getNode(t),e)}getFolder(t){return this._file.getFolder(this.getNode(t))}getFile(t){return this._file.getFile(this.getNode(t))}getTag(t){return this._file.getTag(this.getNode(t))}getEntity(t){return this._file.getEntity(this.getNode(t))}getObjectInfo(t){return this._file.getObjectInfo(this.getNode(t),t)}getCharMap(t){return this._file.getCharMap(this.getNode(t))}getCharMapEntry(t,e,i){this._file.getCharMapEntry(this.getNode(t),e,i)}getVariable(t){return this._file.getVariable(this.getNode(t))}getAnimation(t){return this._file.getAnimation(this.getNode(t))}getMainline(t){return this._file.getBaseline(this.getNode(t))}getMainlineKey(t){return this._file.getMainlineKey(this.getNode(t))}getRef(t){return this._file.getRef(this.getNode(t))}getTimeline(t){return this._file.getTimeline(this.getNode(t))}getSoundline(t){return this._file.getBaseline(this.getNode(t))}getEventline(t){return this._file.getBaseline(this.getNode(t))}getTagline(t){return this._file.getBaseline(this.getNode(t))}getVarline(t){return this._file.getVarline(this.getNode(t))}getKey(t){return this._file.getKey(this.getNode(t))}getTagKey(t){return this._file.getTagKey(this.getNode(t))}getVariableKey(t,e){return this._file.getVariableKey(this.getNode(t),e)}getTimelineKey(t,e){return this._file.getTimelineKey(this.getNode(t),t,e)}getTagChanges(t){for(var e=0,i=0;i<this.length();i++){e|=1<<this._file.getTagChange(this.getNode(i))}return e}}class Y extends T{constructor(t,e){super(e),this._json=t;var i=void 0!==t.min;this.setMinimized(i)}getType(){return i.JSON}parseInt(t,e,i=0){var s=t[this.translateAttributeName(e)];return void 0===s?i:"number"==typeof s?s:parseInt(s)}parseFloat(t,e,i=0){var s=t[this.translateAttributeName(e)];return void 0===s?i:"number"==typeof s?s:parseFloat(s)}parseBoolean(t,e,i=!1){var s=t[this.translateAttributeName(e)];return void 0===s?i:"boolean"==typeof s?s:"true"===s}parseString(t,e,i=""){var s=t[this.translateAttributeName(e)];return void 0===s?i:s}getNodes(t){this.setMinDefsToElementName(t);var e=this.translateElementName(t);return new X(this,void 0!==this._json[e]?this._json[e]:[])}getNodesForElement(t,e){this.setMinDefsToElementName(e);var i=this.translateElementName(e);return new X(this,void 0!==t[i]?t[i]:[])}getFolder(t){return new M(this.parseInt(t,"id"),this.parseString(t,"name"))}getFile(t){return void 0!==t.type&&"sound"===t.type?null:new F(this.parseInt(t,"id"),this.getFileName(this.parseString(t,"name")),this.parseFloat(t,"pivot_x"),1-this.parseFloat(t,"pivot_y"))}getTag(t){return new m(this.parseInt(t,"id"),this.parseString(t,"name"))}getEntity(t){return new S(this.parseInt(t,"id"),this.parseString(t,"name"))}getObjectInfo(t,e){return new x(e,this.parseString(t,"name"),D.getObjectTypeForName(this.parseString(t,"type")),this.parseFloat(t,"w"),this.parseFloat(t,"h"),this.parseFloat(t,"pivot_x"),this.parseFloat(t,"pivot_y"))}getCharMap(t){return new E(this.parseInt(t,"id"),this.parseString(t,"name"))}getCharMapEntry(t,e,i){var s=i.getFolderById(this.parseInt(t,"folder")).getFileById(this.parseInt(t,"file")).name,r=null;void 0!==t.target_folder&&void 0!==t.target_file&&(r=i.getFolderById(this.parseInt(t,"target_folder")).getFileById(this.parseInt(t,"target_file"))),e.put(s,r)}getVariable(t){var e=D.getVariableTypeForName(this.parseString(t,"type"));return new K(this.parseInt(t,"id"),this.parseString(t,"name"),e,2===e?this.parseString(t,"default"):this.parseFloat(t,"default",0))}getAnimation(e){return new u(this.parseInt(e,"id"),this.parseString(e,"name"),this.parseFloat(e,"length"),!0===this.parseBoolean(e,"looping",!0)?t.LOOPING:t.NO_LOOPING)}getMainlineKey(t){return new B(this.parseInt(t,"id"),this.parseFloat(t,"time"))}getRef(t){return new j(this.parseInt(t,"id"),this.parseInt(t,"parent",-1),this.parseInt(t,"timeline"),this.parseInt(t,"key"),this.parseInt(t,"z_index"))}getTimeline(t){return new P(this.parseInt(t,"id"),this.parseString(t,"name"),D.getObjectTypeForName(this.parseString(t,"object_type","sprite")),this.parseInt(t,"obj",-1))}getBaseline(t){return new v(this.parseInt(t,"id"),this.parseString(t,"name",null))}getVarline(t){return new V(this.parseInt(t,"id"),this.parseInt(t,"def"))}getKey(t){return new A(this.parseInt(t,"id"),this.parseInt(t,"time"))}getTagKey(t){return new k(this.parseInt(t,"id"),this.parseInt(t,"time"))}getVariableKey(t,e){return new w(this.parseInt(t,"id"),this.parseInt(t,"time"),2===e?this.parseString(t,"val"):this.parseFloat(t,"val"))}getTimelineKey(t,e,i){var s=this.parseInt(t,"time"),r=this.parseInt(t,"spin",1),a=this.parseString(t,"curve_type","linear"),n=this.parseFloat(t,"c1",0),h=this.parseFloat(t,"c2",0),l=this.parseFloat(t,"c3",0),o=this.parseFloat(t,"c4",0),d=this.translateChildElementName("bone"),p=this.translateChildElementName("object"),g=null,_=null,m=!1;void 0!==t[d]?(_=t[d],g=new O(e,s,r),this.setMinDefsToElementName("bone")):void 0!==t[p]&&(_=t[p],g=new C(e,s,r),this.setMinDefsToElementName("object"),m=!0),"linear"!==a&&g.setCurve(D.getCurveTypeForName(a),n,h,l,o);var u=g.info;if(u.x=this.parseFloat(_,"x"),u.y=-this.parseFloat(_,"y"),u.scaleX=this.parseFloat(_,"scale_x",1),u.scaleY=this.parseFloat(_,"scale_y",1),u.angle=360-this.parseFloat(_,"angle"),u.alpha=this.parseFloat(_,"a",1),m){var c=this.parseInt(_,"folder"),f=this.parseInt(_,"file");g.setFolderAndFile(c,f);var y=i.getFolderById(c).getFileById(f);u.pivotX=this.parseFloat(_,"pivot_x",y.pivotX),u.pivotY=1-this.parseFloat(_,"pivot_y",1-y.pivotY)}return this.popMinDefsStack(),g}getTagChange(t){return this.parseInt(t,"t")}}class U{constructor(t,e){this._file=t,this._nodeList=e}length(){return this._nodeList.length}processed(){this._file.processed()}getChildNodes(t,e){return this._file.getNodesForElement(this._nodeList.item(t),e)}getFolder(t){return this._file.getFolder(this._nodeList.item(t))}getFile(t){return this._file.getFile(this._nodeList.item(t))}getTag(t){return this._file.getTag(this._nodeList.item(t))}getEntity(t){return this._file.getEntity(this._nodeList.item(t))}getObjectInfo(t){return this._file.getObjectInfo(this._nodeList.item(t),t)}getCharMap(t){return this._file.getCharMap(this._nodeList.item(t))}getCharMapEntry(t,e,i){this._file.getCharMapEntry(this._nodeList.item(t),e,i)}getVariable(t){return this._file.getVariable(this._nodeList.item(t))}getAnimation(t){return this._file.getAnimation(this._nodeList.item(t))}getMainline(t){return this._file.getBaseline(this._nodeList.item(t))}getMainlineKey(t){return this._file.getMainlineKey(this._nodeList.item(t))}getRef(t){return this._file.getRef(this._nodeList.item(t))}getTimeline(t){return this._file.getTimeline(this._nodeList.item(t))}getSoundline(t){return this._file.getBaseline(this._nodeList.item(t))}getEventline(t){return this._file.getBaseline(this._nodeList.item(t))}getTagline(t){return this._file.getBaseline(this._nodeList.item(t))}getVarline(t){return this._file.getVarline(this._nodeList.item(t))}getKey(t){return this._file.getKey(this._nodeList.item(t))}getTagKey(t){return this._file.getTagKey(this._nodeList.item(t))}getVariableKey(t,e){return this._file.getVariableKey(this._nodeList.item(t),e)}getTimelineKey(t,e){return this._file.getTimelineKey(this._nodeList.item(t),t,e)}getTagChanges(t){for(var e=0,i=0;i<this.length();i++){e|=1<<this._file.getTagChange(this._nodeList.item(i))}return e}}class R extends T{constructor(t,e){super(e),this._xml=t;var i=t.documentElement.hasAttribute("min");this.setMinimized(i)}getType(){return i.XML}parseInt(t,e,i=0){var s=t.getAttribute(this.translateAttributeName(e));return null!==s?parseInt(s):i}parseFloat(t,e,i=0){var s=t.getAttribute(this.translateAttributeName(e));return null!==s?parseFloat(s):i}parseString(t,e,i=""){var s=t.getAttribute(this.translateAttributeName(e));return null!==s?s:i}getNodes(t){this.setMinDefsToElementName(t);var e=this.translateElementName(t);return new U(this,this._xml.documentElement.getElementsByTagName(e))}getNodesForElement(t,e){this.setMinDefsToElementName(e);var i=this.translateElementName(e);return new U(this,t.getElementsByTagName(i))}getFolder(t){return new M(this.parseInt(t,"id"),this.parseString(t,"name"))}getFile(t){return t.hasAttribute("type")&&"sound"===t.getAttribute("type")?null:new F(this.parseInt(t,"id"),this.getFileName(this.parseString(t,"name")),this.parseFloat(t,"pivot_x"),1-this.parseFloat(t,"pivot_y"))}getTag(t){return new m(this.parseInt(t,"id"),this.parseString(t,"name"))}getEntity(t){return new S(this.parseInt(t,"id"),this.parseString(t,"name"))}getObjectInfo(t,e){return new x(e,this.parseString(t,"name"),D.getObjectTypeForName(this.parseString(t,"type")),this.parseFloat(t,"w"),this.parseFloat(t,"h"),this.parseFloat(t,"pivot_x"),this.parseFloat(t,"pivot_y"))}getCharMap(t){return new E(this.parseInt(t,"id"),this.parseString(t,"name"))}getCharMapEntry(t,e,i){var s=i.getFolderById(this.parseInt(t,"folder")).getFileById(this.parseInt(t,"file")).name,r=null;t.hasAttribute("target_folder")&&t.hasAttribute("target_file")&&(r=i.getFolderById(this.parseInt(t,"target_folder")).getFileById(this.parseInt(t,"target_file"))),e.put(s,r)}getVariable(t){var e=D.getVariableTypeForName(this.parseString(t,"type"));return new K(this.parseInt(t,"id"),this.parseString(t,"name"),e,2===e?this.parseString(t,"default"):this.parseFloat(t,"default",0))}getAnimation(e){return new u(this.parseInt(e,"id"),this.parseString(e,"name"),this.parseFloat(e,"length"),"true"===this.parseString(e,"looping","true")?t.LOOPING:t.NO_LOOPING)}getMainlineKey(t){return new B(this.parseInt(t,"id"),this.parseFloat(t,"time"))}getRef(t){return new j(this.parseInt(t,"id"),this.parseInt(t,"parent",-1),this.parseInt(t,"timeline"),this.parseInt(t,"key"),this.parseInt(t,"z_index"))}getTimeline(t){return new P(this.parseInt(t,"id"),this.parseString(t,"name"),D.getObjectTypeForName(this.parseString(t,"object_type","sprite")),this.parseInt(t,"obj",-1))}getBaseline(t){return new v(this.parseInt(t,"id"),this.parseString(t,"name",null))}getVarline(t){return new V(this.parseInt(t,"id"),this.parseInt(t,"def"))}getKey(t){return new A(this.parseInt(t,"id"),this.parseInt(t,"time"))}getTagKey(t){return new k(this.parseInt(t,"id"),this.parseInt(t,"time"))}getVariableKey(t,e){return new w(this.parseInt(t,"id"),this.parseInt(t,"time"),2===e?this.parseString(t,"val"):this.parseFloat(t,"val"))}getTimelineKey(t,e,i){var s=this.parseInt(t,"time"),r=this.parseInt(t,"spin",1),a=this.parseString(t,"curve_type","linear"),n=this.parseFloat(t,"c1",0),h=this.parseFloat(t,"c2",0),l=this.parseFloat(t,"c3",0),o=this.parseFloat(t,"c4",0),d=this.translateChildElementName("bone"),p=this.translateChildElementName("object"),g=null,_=t.firstElementChild,m=!1;_.tagName===d?(g=new O(e,s,r),this.setMinDefsToElementName("bone")):_.tagName===p&&(this.setMinDefsToElementName("object"),g=new C(e,s,r),m=!0),"linear"!==a&&g.setCurve(D.getCurveTypeForName(a),n,h,l,o);var u=g.info;if(u.x=this.parseFloat(_,"x"),u.y=-this.parseFloat(_,"y"),u.scaleX=this.parseFloat(_,"scale_x",1),u.scaleY=this.parseFloat(_,"scale_y",1),u.angle=360-this.parseFloat(_,"angle"),u.alpha=this.parseFloat(_,"a",1),m){var c=this.parseInt(_,"folder"),f=this.parseInt(_,"file");g.setFolderAndFile(c,f);var y=i.getFolderById(c).getFileById(f);u.pivotX=this.parseFloat(_,"pivot_x",y.pivotX),u.pivotY=1-this.parseFloat(_,"pivot_y",1-y.pivotY)}return this.popMinDefsStack(),g}getTagChange(t){return this.parseInt(t,"t")}}return a})()));